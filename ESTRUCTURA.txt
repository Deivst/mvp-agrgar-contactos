========================================
ESTRUCTURA DEL PROYECTO
========================================

agente_identificador_contactos_mvp/
â”‚
â”œâ”€â”€ ğŸ“„ main.py                          # Punto de entrada - Orchestrator principal
â”œâ”€â”€ ğŸ“„ requirements.txt                 # Dependencias Python
â”œâ”€â”€ ğŸ“„ pytest.ini                       # ConfiguraciÃ³n de tests
â”œâ”€â”€ ğŸ“„ Dockerfile                       # Imagen Docker del bot
â”œâ”€â”€ ğŸ“„ docker-compose.yml               # OrquestaciÃ³n de servicios
â”œâ”€â”€ ğŸ“„ .env.example                     # Variables de entorno de ejemplo
â”œâ”€â”€ ğŸ“„ .gitignore                       # Archivos ignorados por Git
â”œâ”€â”€ ğŸ“„ README.md                        # DocumentaciÃ³n principal
â”œâ”€â”€ ğŸ“„ DEPLOY.md                        # GuÃ­a de despliegue
â”œâ”€â”€ ğŸ“„ prd.md                           # Product Requirements Document
â”‚
â”œâ”€â”€ ğŸ“ config/                          # ConfiguraciÃ³n del sistema
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ settings.py                     # Settings con Pydantic
â”‚
â”œâ”€â”€ ğŸ“ src/                             # CÃ³digo fuente
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ models/                      # Modelos de datos
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ contact.py                  # Modelo Contact con validaciones
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ validators/                  # Validadores
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ message_validator.py        # ValidaciÃ³n de mensajes Telegram
â”‚   â”‚   â””â”€â”€ contact_validator.py        # ValidaciÃ³n de datos de contacto
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ utils/                       # Utilidades
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ logger.py                   # Logging estructurado (structlog)
â”‚   â”‚   â”œâ”€â”€ rate_limiter.py             # Rate limiting por usuario
â”‚   â”‚   â””â”€â”€ helpers.py                  # Funciones auxiliares (vCard, sanitizaciÃ³n)
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ services/                    # Servicios externos
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ gemini_service.py           # Cliente Google Gemini API
â”‚   â”‚   â”œâ”€â”€ contacts_api.py             # Cliente PostgreSQL (SQLAlchemy)
â”‚   â”‚   â””â”€â”€ telegram_service.py         # Cliente Telegram Bot API
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ agents/                      # Agentes del sistema
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ security_agent.py           # ValidaciÃ³n, autenticaciÃ³n, sanitizaciÃ³n
â”‚       â””â”€â”€ persistence_agent.py        # Guardado en BD + notificaciones
â”‚
â”œâ”€â”€ ğŸ“ tests/                           # Suite de tests
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ conftest.py                     # Fixtures compartidos
â”‚   â”œâ”€â”€ ğŸ“ unit/                        # Tests unitarios
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ test_models.py
â”‚   â”‚   â”œâ”€â”€ test_validators.py
â”‚   â”‚   â””â”€â”€ test_security_agent.py
â”‚   â””â”€â”€ ğŸ“ integration/                 # Tests de integraciÃ³n
â”‚       â””â”€â”€ __init__.py
â”‚
â”œâ”€â”€ ğŸ“ scripts/                         # Scripts auxiliares
â”‚   â”œâ”€â”€ init_db.sql                     # Script SQL de inicializaciÃ³n
â”‚   â””â”€â”€ init_db.py                      # Script Python de inicializaciÃ³n
â”‚
â”œâ”€â”€ ğŸ“ docs/                            # DocumentaciÃ³n adicional
â”‚
â””â”€â”€ ğŸ“ logs/                            # Logs de la aplicaciÃ³n


========================================
COMPONENTES PRINCIPALES
========================================

1. CAPA DE ENTRADA
   - TelegramService: Maneja comunicaciÃ³n con Telegram
   - Comandos: /start, /help, /health
   - Handlers: Mensajes de texto

2. AGENTE DE SEGURIDAD (SecurityAgent)
   - AutenticaciÃ³n (whitelist)
   - Rate limiting (10 req/min)
   - ValidaciÃ³n de mensajes
   - SanitizaciÃ³n de datos (OWASP)
   - CoordinaciÃ³n con Gemini

3. PROCESAMIENTO IA (GeminiService)
   - ExtracciÃ³n de entidades (nombre, telÃ©fono, referido)
   - NormalizaciÃ³n de datos
   - Manejo de errores y timeouts

4. AGENTE DE PERSISTENCIA (PersistenceAgent)
   - Guardado en PostgreSQL
   - GeneraciÃ³n de vCard (.vcf)
   - BotÃ³n inline de Telegram
   - Notificaciones al usuario

5. BASE DE DATOS (PostgreSQL)
   - Tabla: contacts
   - Ãndices optimizados
   - Triggers para updated_at


========================================
FUNCIONALIDAD CRÃTICA
========================================

Al guardar un contacto exitosamente:

1. âœ… Se guarda en PostgreSQL
2. ğŸ“§ Se envÃ­a confirmaciÃ³n al usuario
3. ğŸ“‡ Se envÃ­a archivo vCard (.vcf) para importar
4. ğŸ”˜ Se envÃ­a botÃ³n "Agregar a Contactos" de Telegram


========================================
TECNOLOGÃAS
========================================

Backend:
- Python 3.11+
- python-telegram-bot 21.0
- google-generativeai 0.5.0
- SQLAlchemy 2.0.27
- Pydantic 2.6.0
- structlog 24.1.0

Base de Datos:
- PostgreSQL 15

Infraestructura:
- Docker
- Docker Compose

Testing:
- pytest
- pytest-asyncio
- pytest-cov


========================================
COMANDOS ÃšTILES
========================================

# Iniciar con Docker
docker-compose up -d

# Ver logs
docker-compose logs -f bot

# Ejecutar tests
pytest

# Ejecutar tests con cobertura
pytest --cov=src --cov-report=html

# Inicializar BD
python scripts/init_db.py

# Ejecutar localmente
python main.py


========================================
CARACTERÃSTICAS DE SEGURIDAD
========================================

âœ“ Whitelist de usuarios
âœ“ Rate limiting (10 req/min/usuario)
âœ“ SanitizaciÃ³n de inputs (OWASP)
âœ“ Logging de accesos no autorizados
âœ“ Bloqueo automÃ¡tico tras intentos fallidos
âœ“ Variables de entorno para credenciales
âœ“ Usuario no-root en Docker
âœ“ ValidaciÃ³n de datos en mÃºltiples capas

